# 101.1 - تشخیص و پیکربندی تنظیمات سخت‌افزار


## اهداف یادگیری

در این درس با موارد زیر آشنا می‌شوید:

- فعال و غیرفعال کردن peripheral های یکپارچه
- تفاوت انواع دستگاه‌های ذخیره‌سازی
- تشخیص منابع سخت‌افزاری برای دستگاه‌ها
- ابزارهای لیست کردن اطلاعات سخت‌افزار
- ابزارهای مدیریت دستگاه‌های USB
- درک مفهومی sysfs، udev و dbus



## کلیدواژه‌ها

`/sys`, `/proc`, `/dev`, `modprobe`, `lsmod`, `lspci`, `lsusb`



## مقدمه

### سیستم عامل چیست؟

**سیستم عامل** (Operating System) نرم‌افزاری است که:

- منابع سخت‌افزاری را مدیریت می‌کند
- منابع نرم‌افزاری را کنترل می‌کند
- سرویس‌های مشترک به برنامه‌ها ارائه می‌دهد

سیستم عامل روی سخت‌افزار قرار می‌گیرد و زمانی که نرم‌افزارهای دیگر (برنامه‌های فضای کاربری) درخواست می‌کنند، منابع را مدیریت می‌کند.



### Firmware چیست؟

**Firmware** نرم‌افزاری است که روی سخت‌افزار شما اجرا می‌شود. می‌توانید آن را به عنوان یک سیستم عامل یا درایور داخلی برای سخت‌افزارتان در نظر بگیرید.

مادربوردها نیز به Firmware نیاز دارند تا بتوانند کار کنند.

!!! note "نکته"
    Firmware نوعی نرم‌افزار است که در سخت‌افزار زندگی می‌کند.



## انواع Firmware

### 1. BIOS

**BIOS** (Basic Input/Output System) قدیمی و منسوخ شده است.

**ویژگی‌ها:**
- از طریق سیستم منوی متنی قابل تعامل است
- کامپیوتر را با دسترسی به اولین بخش اولین پارتیشن هارد دیسک (MBR) بوت می‌کند
- برای سیستم‌های مدرن کافی نیست
- اکثر سیستم‌ها از روش بوت دو مرحله‌ای استفاده می‌کنند

### 2. UEFI

**UEFI** (Unified Extensible Firmware Interface) استاندارد جدید است.

**ویژگی‌ها:**
- در سال 1998 توسط Intel به عنوان EFI شروع شد
- از یک پارتیشن دیسک خاص برای بوت استفاده می‌کند (EFI System Partition - ESP)
- از سیستم فایل FAT استفاده می‌کند
- در لینوکس در `/boot/efi` قرار دارد
- فایل‌ها با پسوند `.efi` هستند
- باید هر bootloader را ثبت کنید

!!! tip "مقایسه BIOS و UEFI"
    UEFI نسبت به BIOS امکانات بیشتری دارد و از دیسک‌های بزرگ‌تر پشتیبانی می‌کند.



## دستگاه‌های جانبی (Peripheral Devices)

### PCI

**PCI** (Peripheral Component Interconnect) به کاربر اجازه می‌دهد اجزای اضافی را به مادربورد اضافه کند.

اکنون اکثر سرورها از **PCI Express (PCIe)** استفاده می‌کنند.

**کاربردها:**

- هارد دیسک داخلی
  - PATA (قدیمی)
  - SATA (سریال، تا 4 دستگاه)
  - SCSI (موازی، تا 8 دستگاه)
- هارد دیسک خارجی (Fiber، SSD over USB)
- کارت‌های شبکه (RJ 45)
- کارت‌های بی‌سیم (IEEE 802.11)
- Bluetooth (IEEE 802.15)
- شتاب‌دهنده‌های ویدیو
- کارت‌های صوتی



### تفاوت SSD و HDD

| ویژگی | SSD | HDD |
|-------|-----|-----|
| **سرعت** | خواندن ۱۰ برابر، نوشتن ۲۰ برابر سریع‌تر | کندتر |
| **صدا** | بی‌صدا | صدادار |
| **اندازه** | کوچک‌تر | بزرگ‌تر |
| **مقاومت** | مقاوم‌تر در برابر ضربه | حساس‌تر |
| **مصرف انرژی** | کمتر | بیشتر |
| **قیمت** | گران‌تر | ارزان‌تر |
| **ظرفیت** | کمتر | بیشتر |
| **عمر** | ۱۰+ سال | ۳-۵ سال |

!!! info "چرا SSD سریع‌تر است؟"
    SSD از حافظه فلش استفاده می‌کند و هیچ قطعه متحرکی ندارد، در حالی که HDD دارای بازوهای محرک و صفحات چرخان است.



### USB

**USB** (Universal Serial Bus) رابط سریال با اتصالات کمتر است.

**نسخه‌ها:**

| نسخه | سرعت |
|------|------|
| USB 1 | 12 Mbps |
| USB 2 | 480 Mbps |
| USB 3.0 | 5 Gbps |
| USB 3.1 | 10 Gbps |
| USB 3.2 | 20 Gbps |
| USB 4.0 | 40 Gbps |

**انواع کانکتور:** A, B, C



### GPIO

**GPIO** (General Purpose Input Output) برای کنترل دستگاه‌های دیگر استفاده می‌شود.

**مثال‌ها:** Arduino، Raspberry Pi



## مسیرهای مهم سیستم

### /sys - Sysfs

Sysfs یک سیستم فایل شبه (pseudo filesystem) است که توسط کرنل لینوکس ارائه می‌شود.

**ویژگی‌ها:**
- اطلاعات زیرسیستم‌های کرنل را صادر می‌کند
- اطلاعات دستگاه‌های سخت‌افزاری را نمایش می‌دهد
- اطلاعات درایورهای دستگاه را نشان می‌دهد

**محل mount:** `/sys`

    ls /sys

**خروجی:**

    block  bus  class  dev  devices  firmware  fs  hypervisor  kernel  module  power

**توضیحات:**

- `block` - دستگاه‌های بلوکی
- `bus` - دستگاه‌های متصل PCI، USB، سریال و ...
- `class` - دسته‌بندی دستگاه‌ها

!!! note "تفاوت /sys و /dev"
    در `/sys` دستگاه‌ها بر اساس تکنولوژی قرار دارند، اما `/dev` انتزاعی است.



### /dev - فایل‌های دستگاه

**udev** (userspace `/dev`) مدیریت‌کننده دستگاه برای کرنل لینوکس است.

**وظایف udev:**

- مدیریت گره‌های دستگاه در `/dev`
- مدیریت رویدادهای فضای کاربری
- بارگذاری firmware مورد نیاز
- اجرای قوانین هنگام اتصال/جداسازی دستگاه

    ls /dev/sda*

**خروجی:**

    /dev/sda  /dev/sda1  /dev/sda2  /dev/sda3  /dev/sda5  /dev/sda6

**انواع دستگاه‌ها:**

- **Character devices** (c) - دستگاه‌های کاراکتری
- **Block devices** (b) - دستگاه‌های بلوکی

    ls -ltrh /dev/

**خروجی نمونه:**

    crw-rw---- 1 root tty       4,   1 Dec 15  2019 tty1
    crw-rw-rw- 1 root root      1,   5 Dec 15  2019 zero
    brw-rw---- 1 root disk      1,   0 Dec 15  2019 ram0
    brw-rw---- 1 root disk 253,   0 Dec 15  2019 vda



### /proc - اطلاعات پروسس

اینجا جایی است که کرنل تنظیمات و ویژگی‌های خود را نگه می‌دارد.

**محتویات:**

- IRQs (درخواست‌های وقفه)
- پورت‌های I/O
- DMA (دسترسی مستقیم به حافظه)
- پروسس‌ها
- تنظیمات شبکه

    ls /proc/

!!! tip "نکته"
    اعداد نمایش داده شده، شناسه‌های پروسس (PID) هستند!

**فایل‌های مهم:**

- `/proc/cpuinfo` - اطلاعات CPU
- `/proc/meminfo` - اطلاعات حافظه
- `/proc/modules` - ماژول‌های بارگذاری شده

**مثال - مشاهده اطلاعات CPU:**

    cat /proc/cpuinfo

**مثال - تغییر تنظیمات:**

    cat /proc/sys/fs/file-max
    echo 1000000 > /proc/sys/fs/file-max
    cat /proc/sys/fs/file-max

!!! warning "توجه"
    تمام این تغییرات پس از ریبوت بازگردانده می‌شوند. برای دائمی کردن، باید در فایل‌های پیکربندی `/etc/` بنویسید.



## دستورات مدیریت سخت‌افزار

### lspci

نمایش دستگاه‌های PCI متصل به کامپیوتر:

    lspci

**خروجی نمونه:**

    00:00.0 Host bridge: Intel Corporation 2nd Generation Core Processor Family DRAM Controller
    00:02.0 VGA compatible controller: Intel Corporation 2nd Generation Core Processor Family Integrated Graphics Controller
    00:16.0 Communication controller: Intel Corporation 6 Series/C200 Series Chipset Family MEI Controller #1
    00:19.0 Ethernet controller: Intel Corporation 82579LM Gigabit Network Connection



### lsusb

نمایش تمام دستگاه‌های USB متصل به سیستم:

    lsusb

**خروجی نمونه:**

    Bus 002 Device 003: ID 1c4f:0026 SiGma Micro Keyboard
    Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
    Bus 001 Device 005: ID 04f2:b217 Chicony Electronics Co., Ltd Lenovo Integrated Camera



### lshw

نمایش اطلاعات سخت‌افزار. ممکن است نیاز به دسترسی root داشته باشد.

    lshw



### lsblk

لیست دستگاه‌هایی که می‌توانند به صورت بلوکی خوانده یا نوشته شوند:

    lsblk



## ماژول‌های قابل بارگذاری کرنل

لینوکس مانند هر سیستم عامل دیگری به درایورها برای کار با سخت‌افزار نیاز دارد.

**تفاوت با Windows:**
- در Windows باید درایورها را جداگانه نصب کنید
- در لینوکس، سیستم اکثر درایورها را داخلی دارد
- برای جلوگیری از بارگذاری همزمان همه و کاهش حجم کرنل، لینوکس از **ماژول‌های کرنل** استفاده می‌کند

**ماژول‌های کرنل:**
- فایل‌هایی با پسوند `.ko`
- برای گسترش کرنل استفاده می‌شوند
- درایور برای سخت‌افزارهای جدید ارائه می‌دهند



### lsmod

نمایش ماژول‌های کرنل بارگذاری شده:

    lsmod

**خروجی نمونه:**

    Module                  Size  Used by
    bluetooth             446190  22
    uvcvideo               81065  0
    iwlwifi               183038  1

**محل قرارگیری:** `/lib/modules`



### modprobe

مدیریت ماژول‌های کرنل.

**بارگذاری ماژول:**

    modprobe iwlwifi

**حذف ماژول:**

    modprobe -r iwlwifi

**حذف اجباری:**

    modprobe -rf iwlwifi

!!! danger "هشدار"
    استفاده از `-f` برای حذف اجباری ماژول حتی در حال استفاده، می‌تواند خطرناک باشد!



### insmod vs modprobe

**insmod:**

    insmod kernel/drivers/net/wireless/iwlwifi.ko

**مشکلات insmod:**
- وابستگی‌ها را درک نمی‌کند
- نیاز به مسیر کامل فایل ماژول دارد

**modprobe (پیشنهادی):**

    modprobe iwlwifi

**مزایا:**
- وابستگی‌ها را خودکار حل می‌کند
- نیازی به مسیر کامل ندارد



## بارگذاری خودکار ماژول‌ها

برای بارگذاری خودکار ماژول‌ها در هنگام بوت:

**روش 1:** اضافه کردن به `/etc/modules`

    echo "iwlwifi" >> /etc/modules

**روش 2:** اضافه کردن فایل پیکربندی به `/etc/modprobe.d/`

    echo "options iwlwifi 11n_disable=1" > /etc/modprobe.d/iwlwifi.conf



## تمرین‌های عملی

### تمرین 1: لیست دستگاه‌های PCI

    lspci
    lspci -v

### تمرین 2: بررسی اطلاعات CPU

    cat /proc/cpuinfo
    lscpu

### تمرین 3: مدیریت ماژول

    lsmod | grep bluetooth
    sudo modprobe -r bluetooth
    sudo modprobe bluetooth
    modinfo bluetooth

### تمرین 4: بررسی پورت‌های USB

    lsusb
    lsusb -v

### تمرین 5: شناسایی هارد دیسک اصلی

    lsblk
    df -h



## خلاصه

در این درس یاد گرفتیم:

- تفاوت BIOS و UEFI
- انواع دستگاه‌های جانبی و واسط‌ها
- مسیرهای `/sys`، `/proc` و `/dev`
- دستورات `lspci`، `lsusb`، `lsblk`
- مدیریت ماژول‌های کرنل با `modprobe` و `lsmod`
- نقش udev در مدیریت دستگاه‌ها



## نکات آزمون

!!! example "موارد مهم برای آزمون"
    - **وزن:** 2
    - **دستورات کلیدی:** `lspci`, `lsusb`, `lsmod`, `modprobe`
    - **مسیرهای مهم:** `/sys`, `/proc`, `/dev`
    - **مفاهیم:** BIOS vs UEFI، نسخه‌های USB، PCI

