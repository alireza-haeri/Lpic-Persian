# 102.6 Linux به عنوان مهمان مجازی‌سازی

**وزن:** 1  
**توضیح:** داوطلبان باید پیامدهای مجازی‌سازی و رایانش ابری را بر روی یک سیستم مهمان Linux درک کنند.

## حوزه‌های کلیدی دانش
- درک مفهوم کلی ماشین‌های مجازی و کانتینرها
- درک عناصر رایج ماشین‌های مجازی در ابر IaaS، مانند نمونه‌های محاسباتی، ذخیره‌سازی بلوکی و شبکه
- درک ویژگی‌های منحصر به فرد سیستم Linux که باید هنگام کپی یا استفاده به عنوان قالب تغییر کنند
- درک نحوه استفاده از تصاویر سیستم برای استقرار ماشین‌های مجازی، نمونه‌های ابری و کانتینرها
- درک افزونه‌های Linux که Linux را با محصولات مجازی‌سازی یکپارچه می‌کنند
- آگاهی از cloud-init

## اصطلاحات
- Virtual machine (ماشین مجازی)
- Linux container (کانتینر Linux)
- Application container (کانتینر برنامه)
- Guest drivers (درایورهای مهمان)
- SSH host keys (کلیدهای میزبان SSH)
- D-Bus machine id (شناسه ماشین D-Bus)

## مقدمه

ماشین‌های مجازی (VMs) کامپیوترهای **شبیه‌سازی شده** هستند. می‌توانید از ماشین‌های مجازی برای ایجاد کامپیوترهای جدید بر روی ماشین در حال اجرای خود استفاده کنید و سیستم‌عامل‌های جدید را در آنجا نصب کنید. در برخی موارد، همچنین امکان اجرای فقط بخش‌هایی از یک سیستم‌عامل بر روی سیستم‌عامل فعلی وجود دارد؛ این به داشتن کانتینرها معروف است.

برای اجرای ماشین‌های مجازی، به نرم‌افزار **Hypervisor** (که مدیر ماشین مجازی یا VMM نیز نامیده می‌شود) نیاز داریم. دو نوع هایپروایزر داریم.

برای بررسی اینکه آیا سیستم‌عامل میزبان/CPU شما از استفاده از هایپروایزرها پشتیبانی می‌کند، برای `vmx` (برای CPU های Intel) یا `svm` (برای CPU های AMD) در `/proc/cpuinfo` در flags بررسی کنید.

ممکن است نیاز داشته باشید گزینه هایپروایزر را با استفاده از BIOS یا UEFI خود روشن کنید.

بر اساس CPU خود باید ماژول‌های کرنل `kvm` یا `kvm-amd` بارگذاری شده باشند:

```bash
lsmod | grep -i kvm
sudo modprobe kvm
```

اگر `hypervisor` را در `/proc/cpuinfo` خود ببینید، به این معنی است که در داخل یک ماشین Linux مجازی شده هستید :)

اکنون، بیایید 2 نوع هایپروایزر را ببینیم. ابتدا نوع 2، چون درک آن آسان‌تر است.

## هایپروایزر نوع 2 (Type 2 Hypervisor)

این هایپروایزرها روی یک سیستم‌عامل معمولی (OS) مانند سایر برنامه‌های کامپیوتری اجرا می‌شوند. یک سیستم‌عامل مهمان به عنوان یک فرآیند روی میزبان اجرا می‌شود. هایپروایزرهای نوع 2 سیستم‌عامل‌های مهمان را از سیستم‌عامل میزبان انتزاعی می‌کنند.

به عبارت دیگر، یک هایپروایزر نوع 2 نرم‌افزار بین مهمان و میزبان است. کاملاً روی سیستم‌عامل میزبان اجرا می‌شود و مجازی‌سازی را برای مهمان فراهم می‌کند.

دو تا از معروف‌ترین هایپروایزرهای نوع 2 عبارتند از **VirtualBox** (از Oracle) و **VMware**.

## هایپروایزر نوع 1 (Type 1 Hypervisor)

این هایپروایزرها مستقیماً روی سخت‌افزار میزبان اجرا می‌شوند تا سخت‌افزار را کنترل کرده و سیستم‌عامل‌های مهمان را مدیریت کنند. به همین دلیل، گاهی اوقات هایپروایزرهای bare-metal نامیده می‌شوند. اولین هایپروایزرها که IBM در دهه 1960 توسعه داد، هایپروایزرهای بومی بودند. اینها شامل نرم‌افزار تست SIMMON و سیستم‌عامل CP/CMS، پیشرو IBM z/VM بودند.

برخی از معروف‌ترین هایپروایزرهای نوع 1 عبارتند از **KVM**، **Xen** و **Hyper-V**.

**KVM** از نسخه 2.6.20 کرنل Linux داخلی است.

## ایجاد یک ماشین مجازی

ابتدا، خود ماشین را ایجاد کنید. به هایپروایزر می‌گوییم این ماشین چقدر RAM/disk/CPU/... نیاز دارد و یک نام برای ماشین خود تنظیم می‌کنیم. سپس نیاز داریم سیستم‌عامل مهمان را **نصب** کنیم. این کار می‌تواند با استفاده از موارد زیر انجام شود:

- نصب از CD / DVD / ...
- **کلون کردن** یک ماشین موجود
- استفاده از **Open Virtualization Format (OVF)** برای انتقال ماشین‌ها بین هایپروایزرها. این یک فرمت استاندارد برای تعریف ماشین مجازی است و ممکن است شامل چندین فایل باشد، در این صورت، می‌توانید همه آنها را در یک فایل **Open Virtualization Archive (OVA)** آرشیو کنید.

همچنین امکان ایجاد **Templates** (قالب‌ها) که **نسخه‌های اصلی** هستند برای شروع ماشین‌های جدید وجود دارد.

ممکن است نیاز داشته باشید برخی **guest drivers** یا **additions** را نصب کنید تا به هایپروایزر خود کمک کنید تا کنترل بهتری بر ماشین مهمان خود داشته باشد. اینها ممکن است شامل درایورهای گرافیکی برای VirtualBox یا اسکریپت‌هایی برای کمک به VMWare برای کنترل یک ماشین مهمان یا بررسی وضعیت آن باشند.

## پیکربندی‌های خاص مهمان

برخی پیکربندی‌ها خاص ماشین هستند. به عنوان مثال، آدرس MAC یک کارت شبکه باید برای کل شبکه منحصر به فرد باشد. اگر در حال کلون کردن یک ماشین هستیم یا گاهی اوقات آنها را از قالب‌ها ایجاد می‌کنیم، حداقل باید اینها را در هر ماشین قبل از بوت تغییر دهیم:

- **Host Name:** نام میزبان
- **NIC MAC Address:** آدرس MAC کارت شبکه
- **NIC IP:** IP کارت شبکه (اگر از DHCP استفاده نمی‌کنید)
- **Machine ID:** شناسه ماشین (فایل‌های `/etc/machine-id` و `/var/lib/dbus/machine-id` را حذف کنید و `dbus-uuidgen --ensure` را اجرا کنید. این دو فایل ممکن است لینک نرم به یکدیگر باشند)
- **Encryption Keys:** کلیدهای رمزگذاری مانند اثر انگشت SSH و کلیدهای PGP
- **HDD UUIDs:** شناسه‌های منحصر به فرد هارد
- **Any other UUIDs:** هر UUID دیگری در سیستم

برخی پیکربندی‌ها ممکن است در قالب‌ها خالی باشند، فراموش نکنید که آنها را نیز پر کنید.

## کانتینرها (Containers)

در بخش‌های قبلی، ما با سیستم‌عامل‌های مهمان کامل سر و کار داشتیم. اما همچنین امکان مجازی‌سازی فقط بخش‌هایی از یک سیستم‌عامل وجود دارد؛ این **مجازی‌سازی سطح سیستم‌عامل** نامیده می‌شود.

مجازی‌سازی سطح سیستم‌عامل یک پارادایم سیستم‌عامل (OS) است که در آن کرنل اجازه وجود چندین نمونه فضای کاربری جداگانه به نام کانتینرها را می‌دهد.

این کار می‌تواند برای اجرای یک برنامه یا سرویس یا حتی اجرای بیشتر بخش‌های یک سیستم‌عامل جدید برای اهداف آزمایشی انجام شود.

## IaaS (زیرساخت به عنوان سرویس)

همانطور که از نام پیداست، **Infrastructure as a Service** یا IaaS به معنای برون‌سپاری بخش‌هایی از زیرساخت شما به شرکت‌های دیگر است. این به معنای خرید **سرویس‌هایی** مانند برق، خنک‌سازی و حتی اجرای هایپروایزرها به شرکت دیگری و فقط اجاره ماشین مجازی خود از آنها است. این زندگی شما را آسان‌تر می‌کند زیرا چیزهایی مانند "اضافه کردن هارد جدید" اکنون فقط به معنای پرداخت کمی بیشتر برای HDD بیشتر روی ماشین شما است؛ به جای خرید HDD و نصب آنها و... این ابر (cloud) نامیده می‌شود! حتی ممکن است بتوانید ماشین خود را از یک قاره به قاره دیگر فقط با یک کلیک منتقل کنید.

نمونه‌هایی از این ارائه‌دهندگان ابری عبارتند از **Amazon Web Services**، **Google Cloud Platform** و **Microsoft Azure**.

ارائه‌دهندگان مختلف ابری ممکن است سطوح مختلفی از زیرساخت یا سرویس‌ها را ارائه دهند. اینها چند نمونه هستند:

- **Load Balancing:** توزیع درخواست‌های ورودی بین سرورهای شما
- **Block Storage:** ارائه دیسک‌هایی که توسط شما پیکربندی و به ماشین‌های شما اضافه می‌شوند
- **Object Storage:** به شما امکان می‌دهد داده‌های خود را مستقیماً ذخیره کنید؛ مثلاً برای عکس‌ها
- **Elasticity:** به شما امکان می‌دهد افزایش/کاهش خودکار در ظرفیت سرویس خود را بر اساس حجم درخواست پیکربندی کنید
- **SaaS:** Software as a Service به شما امکان می‌دهد از نرم‌افزار مورد نیاز خود، روی ابر به عنوان یک سرویس استفاده کنید. به داشتن یک مجموعه آفیس آنلاین برای شرکت خود بدون نصب چیزی روی ایستگاه‌های کاری فکر کنید.

برنامه‌هایی مانند **cloud-init** وجود دارند که به شما کمک می‌کنند ماشین ابری خود را با سهولت راه‌اندازی کنید. این سرویس می‌تواند به شما کمک کند ماشین‌ها را بر اساس قالب‌ها در AWS، Azure، Digital Ocean و دیگران با سهولت راه‌اندازی کنید.

---

**خلاصه:** ماشین‌های مجازی با استفاده از هایپروایزرها اجرا می‌شوند - نوع 2 روی سیستم‌عامل اجرا می‌شود (VirtualBox، VMware) و نوع 1 مستقیماً روی سخت‌افزار (KVM، Xen). هنگام کلون کردن ماشین‌ها، پیکربندی‌های خاصی مانند hostname، MAC address، IP، machine-id و کلیدهای SSH باید تغییر کنند. کانتینرها مجازی‌سازی سطح سیستم‌عامل را ارائه می‌دهند. IaaS (زیرساخت به عنوان سرویس) امکان اجاره منابع ابری از ارائه‌دهندگانی مانند AWS، Google Cloud و Azure را فراهم می‌کند.

---

← 102.5 استفاده از مدیریت بسته RPM و YUM  
**فهرست فصل‌ها**  
103.1 کار بر روی خط فرمان →

**دسته‌بندی:** LPIC1  
**برچسب‌ها:** 101، LPIC1، LPIC1-101-500  
**تماس**
