# 102.1 - طراحی پارتیشن‌بندی هارد دیسک

## اهداف یادگیری

در این فصل با موارد زیر آشنا می‌شوید:

- تخصیص فایل‌سیستم‌ها و فضای swap به پارتیشن‌ها یا دیسک‌های جداگانه  
- طراحی پارتیشن‌بندی متناسب با کاربرد سیستم  
- اطمینان از سازگاری پارتیشن `/boot` با معماری سخت‌افزار برای بوت  
- آشنایی با ویژگی‌های پایه‌ای LVM  

## کلیدواژه‌ها

`/ (root)`, `/var`, `/home`, `/boot`, `EFI System Partition (ESP)`, `swap`, `mount points`, `partitions`, `fdisk`, `parted`, `gparted`, `LVM`

---

## مبانی

لینوکس مانند هر سیستم‌عامل مدرن از فایل‌ها و دایرکتوری‌ها استفاده می‌کند. برخلاف ویندوز که درایوها را با حروف (C:, D:) مشخص می‌کند، در لینوکس همه چیز در یک درخت بزرگ با ریشه `/` قرار دارد. هر دیسک، پارتیشن، USB یا حتی درایو شبکه در این درخت mount می‌شود.

!!! note "نکته"
    بیشتر دستگاه‌های خارجی مانند USB یا CD در مسیر `/media/` یا `/mnt/` mount می‌شوند.

---

## استاندارد سلسله‌مراتب فایل‌ها (FHS)

شناخت FHS به شما کمک می‌کند بدون دانش قبلی، محل برنامه‌ها، تنظیمات و لاگ‌ها را پیدا کنید.  

| دایرکتوری | توضیح |
|-----------|-------|
| `bin` | دستورات ضروری |
| `boot` | فایل‌های بوت‌لودر |
| `dev` | فایل‌های دستگاه |
| `etc` | تنظیمات سیستم |
| `home` | دایرکتوری کاربران |
| `lib` | کتابخانه‌های ضروری و ماژول‌های کرنل |
| `media` | محل mount رسانه‌های قابل حمل |
| `mnt` | mount موقت فایل‌سیستم |
| `opt` | نرم‌افزارهای جانبی |
| `root` | دایرکتوری کاربر root |
| `sbin` | دستورات سیستمی ضروری |
| `srv` | داده‌های سرویس‌ها |
| `tmp` | فایل‌های موقت |
| `usr` | سلسله‌مراتب ثانویه |
| `var` | داده‌های متغیر (مثل لاگ‌ها) |

---

## پارتیشن‌ها

دستگاه‌ها در لینوکس در مسیر `/dev/` تعریف می‌شوند:

- PATA (قدیمی): `/dev/hdc`  
- SATA/SCSI: `/dev/sda`  
- NVME: `/dev/nvme0n1`  
- SD/eMMC: `/dev/mmcblk0p0`  

هر دیسک باید **پارتیشن‌بندی** شود. سیستم‌عامل هر پارتیشن را مانند یک دیسک مستقل می‌بیند.  

نمونه‌ها:  
- `/dev/sda1` → اولین پارتیشن دیسک اول  
- `/dev/sdb5` → اولین پارتیشن منطقی دیسک دوم  

### MBR (BIOS)
- حداکثر 4 پارتیشن اصلی  
- امکان ایجاد پارتیشن Extended و Logical  

### GPT (UEFI)
- پشتیبانی از 128 پارتیشن اصلی  
- نیازی به پارتیشن Extended نیست  

---

## ابزارهای مدیریت پارتیشن

### fdisk

```bash
fdisk /dev/sda
```

نمونه خروجی:

```
Device     Boot     Start       End   Sectors   Size Id Type
/dev/sda1  *         2048  43094015  20.6G 83 Linux
/dev/sda2        43094016  92078390  23.4G 83 Linux
/dev/sda3        92080126 625141759 254.2G  5 Extended
/dev/sda5        92080128 107702271  7.5G 82 Linux swap
/dev/sda6       107704320 625141759 246.8G 83 Linux
```

### parted

```bash
sudo parted /dev/sda p
```

### gparted

ابزار گرافیکی برای مدیریت دیسک و پارتیشن‌ها.

---

## LVM (مدیریت حجم منطقی)

LVM امکان مدیریت انعطاف‌پذیر دیسک‌ها و پارتیشن‌ها را فراهم می‌کند:

- **PV (Physical Volume):** دیسک یا پارتیشن کامل  
- **VG (Volume Group):** مجموعه‌ای از PVها، دیده‌شده به عنوان یک دیسک بزرگ  
- **LV (Logical Volume):** پارتیشن منطقی که می‌تواند فرمت و استفاده شود  

---

## طراحی پارتیشن‌بندی

### Swap
- مانند حافظه مجازی عمل می‌کند  
- در `/etc/fstab` تعریف می‌شود  
- فرمول دقیق ندارد؛ معمولاً RAM × 2 یا RAM + 2GB  

### /boot
- معمولاً 100MB کافی است  
- باید توسط BIOS/UEFI قابل دسترسی باشد  
- در سیستم‌های UEFI مسیر `/boot/efi` برای ESP استفاده می‌شود  

---

## سناریوهای مختلف

### 1. دسکتاپ
- یک پارتیشن swap  
- یک پارتیشن `/boot`  
- بقیه فضا برای `/`  

### 2. ایستگاه کاری شبکه
- `/boot` محلی  
- `/home` از طریق شبکه (NFS, SMB, SSH)  
- swap محلی یا شبکه‌ای  

### 3. سرور
- `/boot` محلی  
- جداسازی `/var` برای لاگ‌ها  
- امکان جداسازی `/usr` و mount به صورت read-only یا شبکه‌ای  
- استفاده از RAID برای جلوگیری از از دست رفتن داده‌ها  

---

## Bonus: ZRAM

- دیسک مجازی روی RAM  
- قابل استفاده به عنوان swap یا mount برای مسیرهایی مثل `/tmp`  
- مثال‌ها:  
  - Debian 11 → پارتیشن swap  
  - Ubuntu 22.04 → فایل swap  
  - Fedora 36 → zram  

---

## تمرین‌های عملی

### تمرین 1: بررسی دیسک‌ها
```bash
fdisk -l
parted /dev/sda p
```

### تمرین 2: ایجاد پارتیشن جدید
```bash
fdisk /dev/sdb
```

### تمرین 3: بررسی LVM
```bash
vgdisplay
lvdisplay
```

### تمرین 4: بررسی swap
```bash
swapon --show
```

---

## خلاصه

در این فصل یاد گرفتیم:

- ساختار FHS و دایرکتوری‌های مهم  
- تفاوت MBR و GPT در پارتیشن‌بندی  
- ابزارهای مدیریت دیسک: `fdisk`, `parted`, `gparted`  
- مفاهیم LVM (PV, VG, LV)  
- طراحی پارتیشن‌بندی برای دسکتاپ، ایستگاه کاری شبکه و سرور  
- نقش swap و `/boot` در سیستم  
- آشنایی با ZRAM  

!!! example "نکات کلیدی برای آزمون"
    - تفاوت MBR و GPT  
    - مسیرهای مهم FHS  
    - ابزارهای مدیریت پارتیشن  
    - مفاهیم LVM  
    - اندازه swap و نقش `/boot`  
    - سناریوهای مختلف طراحی دیسک  
