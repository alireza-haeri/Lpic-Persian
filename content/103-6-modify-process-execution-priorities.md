# 103.6 تغییر اولویت اجرای فرآیندها

**وزن:** 2  
**توضیح:** داوطلبان باید قادر به مدیریت اولویت‌های اجرای فرآیند باشند.

## اهداف
- دانستن اولویت پیش‌فرض یک کار ایجاد شده
- اجرای یک برنامه با اولویت بالاتر یا پایین‌تر از پیش‌فرض
- تغییر اولویت یک فرآیند در حال اجرا

## اصطلاحات
- nice
- ps
- renice
- top

## مدیریت اولویت فرآیندها

در یک ماشین Linux، ممکن است صدها فرآیند همزمان در حال اجرا باشند و برای CPU و RAM بیشتر رقابت کنند. خبر خوب این است که می‌توانید به برخی از فرآیندها اولویت بالاتر یا پایین‌تر (یا nice-ness) در این رقابت بدهید. بیایید نگاهی به یک خروجی نمونه از `top` بیندازیم:

```bash
$ top
Tasks: 169 total,   1 running, 168 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.0 us,  3.0 sy,  0.0 ni, 97.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
MiB Mem :   5948.9 total,   4115.2 free,    438.2 used,   1395.5 buff/cache
MiB Swap:    975.0 total,    975.0 free,      0.0 used.   5210.3 avail Mem
PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
6496 jadi      20   0   10112   3704   3212 R   6.2   0.1   0:00.01 top
1 root      20   0  165172  10576   7780 S   0.0   0.2   0:02.80 systemd
2 root      20   0       0      0      0 S   0.0   0.0   0:00.09 kthreadd
3 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 rcu_gp
4 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 rcu_par_gp
6 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/0:0H-events_highpri
8 root       0 -20       0      0      0 I   0.0   0.0   0:12.71 kworker/0:1H-events_highpri
9 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 mm_percpu_wq
10 root      20   0       0      0      0 S   0.0   0.0   0:00.00 rcu_tasks_rude_
11 root      20   0       0      0      0 S   0.0   0.0   0:00.00 rcu_tasks_trace
```

ستون **NI** نشان می‌دهد که این فرآیند چقدر `nice` است. هرچه فرآیند nice-تر باشد، CPU کمتری درخواست می‌کند. مقادیر `nice` می‌توانند از -20 تا 19 باشند. برای تفسیر این مقدار، به این شکل به آن نگاه کنید: یک فرآیند با nice = **-20** عصبانی است و اولویت بیشتری برای CPU و RAM دریافت می‌کند در حالی که یک فرآیند با nice = **19** خیلی مودب است و به فرآیندهای **دیگر** اجازه می‌دهد قبل از خود از منابع استفاده کنند.

مقدار پیش‌فرض برای `nice` معمولاً روی 0 تنظیم شده است؛ این را می‌توان با این دستور بررسی کرد:

```bash
$ nice
0
```

همچنین می‌توانید nice-ness را با استفاده از دستور `ps` بررسی کنید:

```bash
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000 15044 15035  0  80   0 -  7453 wait   pts/29   00:00:00 bash
0 S  1000 15052 15044  0  60 -20 -  3976 hrtime pts/29   00:00:00 sleep
0 R  1000 15080 15044  0  80   0 -  4680 -      pts/29   00:00:00 ps
```

## تنظیم nice-ness

اگر نیاز دارید سطح niceness یک برنامه را تغییر دهید، می‌توانید آن را با دستور `nice` و سوییچ `-n` (برای nice) اجرا کنید:

```bash
$ nice -n 19 echo "I am running!"
I am running!
$ nice -n -20 echo "I am running!"
nice: cannot set niceness: Permission denied
I am running!
$ sudo nice -n -20 echo "I am running!"
I am running!
```

همانطور که در مثال بالا می‌بینید، فقط root می‌تواند niceness با اولویت بالا (زیر 0) را صادر کند.

اگر یک دستور را با `nice` بدون `-n` اجرا کنید، پیش‌فرض `-n 10` خواهد بود:

```bash
$ nice xeyes &
[1] 15217
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000 15044 15035  0  80   0 -  7455 wait   pts/29   00:00:00 bash
0 S  1000 15217 15044  0  90  10 - 12522 poll_s pts/29   00:00:00 xeyes
0 R  1000 15218 15044  0  80   0 -  4680 -      pts/29   00:00:00 ps
```

## تغییر اولویت‌ها

دستور `renice` می‌تواند برای تغییر `niceness` فرآیندهای در حال اجرای شما (یا دیگران اگر root هستید) استفاده شود:

```bash
$ ps -ef | grep firefox
jadi     13605 11226 30 08:28 ?        00:10:13 /usr/lib/firefox/firefox
jadi     15192 15044  0 09:01 pts/29   00:00:00 grep firefox
$ sudo renice -n -10 13605
13605 (process ID) old priority 5, new priority -10
```

همچنین می‌توانید در دستور `top` کلید `r` را فشار دهید تا یک فرآیند را renice کنید.

---

**مثال عملی:** فرض کنید می‌خواهید یک پردازش سنگین را اجرا کنید اما نمی‌خواهید سیستم را کند کند. می‌توانید آن را با nice بالا اجرا کنید:
```bash
$ nice -n 15 ./heavy_process.sh
```
این کار باعث می‌شود فرآیند شما اولویت کمتری داشته باشد و سایر برنامه‌ها روان‌تر کار کنند.

**خلاصه:** در Linux می‌توانید با استفاده از `nice` و `renice` اولویت فرآیندها را مدیریت کنید. مقادیر nice از -20 (بالاترین اولویت، فقط root) تا 19 (پایین‌ترین اولویت) هستند. از `nice` برای شروع فرآیند با اولویت خاص و از `renice` برای تغییر اولویت فرآیند در حال اجرا استفاده می‌شود. می‌توانید nice-ness را در `top` یا با `ps -l` مشاهده کنید.

---

← 103.5 ایجاد، نظارت و کشتن فرآیندها  
**فهرست فصل‌ها**  
103.7 جستجوی فایل‌های متنی با استفاده از عبارات منظم →

**دسته‌بندی:** LPIC1  
**برچسب‌ها:** 101، LPIC1، LPIC1-101-500  
**تماس**
