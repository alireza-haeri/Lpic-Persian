```markdown
# 104.1 - ایجاد پارتیشن‌ها و فایل‌سیستم‌ها

## اهداف یادگیری

در این فصل با موارد زیر آشنا می‌شوید:

- پیکربندی جدول پارتیشن‌های **MBR** و **GPT**
- استفاده از ابزارهایی مانند `fdisk`, `gdisk`, `parted` برای ساخت و ویرایش پارتیشن
- ایجاد فایل‌سیستم‌ها با `mkfs` (ext2/ext3/ext4, XFS, VFAT, exFAT) و ایجاد فضای swap با `mkswap`
- آشنایی با ویژگی‌های پایه‌ای **Btrfs** (multi-device، فشرده‌سازی و subvolumes)

## کلیدواژه‌ها

`fdisk`, `gdisk`, `parted`, `mkfs`, `mkswap`, `lsblk`, `blkid`, `UUID`, `btrfs`

---

## دستگاه‌های بلوکی (Block devices)

دستگاه بلوکی نوعی رسانه ذخیره‌سازی غیر فرّار است که می‌توان داده‌ها را به صورت بلوک‌های مستقل روی آن خواند/نوشت؛ مانند هارد‌دیسک‌ها، درایوهای USB و CD-ROM.

برای فهرست کردن دستگاه‌های بلوکی از `lsblk` استفاده کنید:

```bash
$ lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0   20G  0 disk
sda1     8:1    0  512M  0 part /boot/efi
sda2     8:2    0 18.5G  0 part /
sda3     8:3    0  976M  0 part [SWAP]
```

علامتی مانند `b` در خروجی `ls -l /dev` نشان می‌دهد که دستگاه از نوع بلوکی است.

---

## ویرایش جدول پارتیشن

سه ابزار رایج برای ویرایش جدول پارتیشن وجود دارد:

- `fdisk` برای دستگاه‌های سنتی با MBR
- `gdisk` برای دستگاه‌های GPT
- `parted` برای کارهای پیشرفته‌تر (مثلاً تغییر اندازه پارتیشن‌ها)

نمونهٔ استفاده از `fdisk -l` برای نشان دادن جدول پارتیشن:

```bash
# fdisk -l /dev/sdb
Disk /dev/sdb: 20 GiB, ...
Disklabel type: gpt
Device     Start      End  Sectors  Size Type
/dev/sdb1   2048   1050623 1048576  512M EFI System
/dev/sdb2 1050624 39942143 38891520 18.5G Linux filesystem
/dev/sdb3 39942144 41940991 1998848 976M Linux swap
```

در حالت تعاملی `fdisk`، دستور `m` منوی کمک را نمایش می‌دهد و `n` برای ایجاد پارتیشن جدید استفاده می‌شود. در پایان تغییرات باید `w` را اجرا کنید تا جدول روی دیسک نوشته شود.

`gdisk` مشابه `fdisk` است اما برای GPT مناسب است و امکاناتی مانند پشتیبان‌گیری از GPT را دارد. `parted` نیز برای تغییر اندازه پارتیشن‌ها مناسب است و در برخی شرایط برای کار روی دیسک‌های بزرگ‌تر (GPT) راحت‌تر است.

!!! note "نکته"
    اگر از محیط گرافیکی استفاده می‌کنید، ابزار `gparted` رابط گرافیکی خوبی دارد، اما آشنایی با ابزارهای متنی (`fdisk`, `gdisk`, `parted`) برای مدیریت سرورها ضروری است.

---

## ساخت فایل‌سیستم‌ها

پس از ایجاد پارتیشن، باید آن را فرمت کنید تا قابل استفاده شود. برای این کار از `mkfs` و یا فرامین خاص هر فایل‌سیستم استفاده می‌شود:

| نوع | ابزار نمونه |
|-----|-------------|
| ext2/ext3/ext4 | `mkfs.ext4`, `mke2fs` |
| XFS | `mkfs.xfs` |
| VFAT (FAT32) | `mkfs.vfat` |
| exFAT | `mkfs.exfat` |
| swap | `mkswap` و سپس `swapon` |

مثال فرمت یک پارتیشن به ext4:

```bash
# mkfs.ext4 /dev/sda1
mke2fs 1.46.2 ( ... )
Creating filesystem with ...
```

برای ایجاد swap:

```bash
# mkswap /dev/sda6
# swapon /dev/sda6
```

در سیستم‌های مدرن به‌جای نام‌های دستگاهی متغیر (`/dev/sdb1`) معمولاً از **UUID** یا **LABEL** استفاده می‌شود تا عدم قطعیت در هنگام وصل/جدا شدن دیسک‌ها برطرف شود:

```bash
# blkid /dev/sda1
/dev/sda1: UUID="63625ecd-..." TYPE="ext4" PARTUUID="..."
# lsblk -o NAME,UUID,MOUNTPOINT
```

---

## معرفی فایل‌سیستم‌های مهم

- **ext4**: نسخهٔ فعلی و رایج، پشتیبانی از فایل‌ها و فایل‌سیستم‌های بزرگ
- **XFS**: مناسب برای بارهای کاری بزرگ و فایل‌سرور‌ها، journaling
- **VFAT / exFAT**: مناسب برای تبادل داده با سیستم‌های دیگر (مثل Windows)
- **btrfs**: فایل‌سیستم مدرن با ویژگی‌هایی مانند multi-device، subvolumes، و فشرده‌سازی

!!! tip "نکته"
    برخی توزیع‌ها ابزارهای `xfsprogs` یا `btrfs-progs` را به صورت پیش‌فرض نصب ندارند — در صورت نیاز آنها را نصب کنید.

---

## چک‌لیست عملی

1. با `lsblk` دستگاه‌ها را شناسایی کنید.
2. با `fdisk` / `gdisk` / `parted` پارتیشن‌های لازم را بسازید/ویرایش کنید.
3. پارتیشن‌ها را با `mkfs` یا `mkswap` فرمت کنید.
4. از `blkid` یا `lsblk -o UUID` برای به‌دست آوردن UUID استفاده کرده و در `/etc/fstab` برای mount ثابت قرار دهید.

---

## تمرین‌ها

1. یک دیسک مجازی 4GiB بسازید و با `fdisk` دو پارتیشن ایجاد کنید: یکی ext4 با 3GiB و یکی swap با 1GiB.
2. پارتیشن ext4 را فرمت کرده، UUID آن را پیدا کنید و با استفاده از UUID آن را در `/etc/fstab` به‌صورت خودکار mount کنید.

---

## خلاصه

در این فصل چگونگی ایجاد و مدیریت پارتیشن‌ها و فایل‌سیستم‌ها را آموختیم؛ ابزارهای مهم شامل `fdisk`, `gdisk`, `parted`, `mkfs`, `mkswap`, `lsblk` و `blkid` هستند. دانستن تفاوت میان MBR و GPT و استفاده از UUID برای mount پایدار از مهارت‌های کلیدی است.

← 103.8 Basic file editing
Chapter List
